<div class="non-market-timeline">

  <!-- Hour selector -->
  <div class="hour-bar">
    <span class="hour-label">Hour:</span>

    <button
      mat-raised-button
      *ngFor="let h of hours24"
      [color]="selectedHour === h ? 'primary' : undefined"
      (click)="selectHour(h)"
    >
      {{ h | number:'2.0-0' }}:00
    </button>
  </div>

  <div class="timeline-container">
    <!-- LEFT: Time scroll -->
    <div class="time-tree">
      <h3 class="section-title">Time ({{ selectedHour ?? '-' }})</h3>

      <cdk-virtual-scroll-viewport itemSize="26" class="time-viewport">
        <div
          *cdkVirtualFor="let row of timeRows"
          class="time-row"
          [class.hour-row]="row.minute === null"
          [class.minute-row]="row.minute !== null"
          [class.selected]="isMinuteSelected(row)"
          (click)="onTimeRowClick(row)"
        >
          {{ row.label }}
        </div>
      </cdk-virtual-scroll-viewport>
    </div>

    <!-- RIGHT: Logs -->
    <div class="logs-panel">
<h3 class="section-title">
  Logs
  @if (selectedMinute !== null && selectedHour !== null) {
    <span class="minute-tag">
      {{ selectedHour | number:'2.0-0' }}:{{ selectedMinute | number:'2.0-0' }}
    </span>
  }
</h3>


      <!-- source filter -->
      <div class="source-filter">
        <button mat-stroked-button
                [color]="currentSourceFilter==='ALL'?'primary':undefined"
                (click)="setSourceFilter('ALL')">
          All
        </button>

        <button mat-stroked-button
                [color]="currentSourceFilter==='MARKET'?'primary':undefined"
                (click)="setSourceFilter('MARKET')">
          Market
        </button>

        <button mat-stroked-button
                [color]="currentSourceFilter==='TEST'?'primary':undefined"
                (click)="setSourceFilter('TEST')">
          Test
        </button>
      </div>

      <cdk-virtual-scroll-viewport itemSize="28" class="logs-viewport">
        <table
          mat-table
          [dataSource]="filteredLogs"
          class="mat-elevation-z1 logs-table"
        >
          <ng-container matColumnDef="time">
            <th mat-header-cell *matHeaderCellDef>Time</th>
            <td mat-cell *matCellDef="let log">
              {{ log.timestamp | date:'HH:mm:ss' }}
            </td>
          </ng-container>

          <ng-container matColumnDef="symbol">
            <th mat-header-cell *matHeaderCellDef>Symbol</th>
            <td mat-cell *matCellDef="let log">
              {{ log.symbol }}
            </td>
          </ng-container>

          <ng-container matColumnDef="source">
            <th mat-header-cell *matHeaderCellDef>Source</th>
            <td mat-cell *matCellDef="let log">
              {{ log.source }}
            </td>
          </ng-container>

          <ng-container matColumnDef="event">
            <th mat-header-cell *matHeaderCellDef>Event</th>
            <td mat-cell *matCellDef="let log">
              {{ log.event }}
            </td>
          </ng-container>

          <ng-container matColumnDef="details">
            <th mat-header-cell *matHeaderCellDef>Details</th>
            <td mat-cell *matCellDef="let log">
              {{ log.details }}
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
        </table>
      </cdk-virtual-scroll-viewport>
    </div>
  </div>
</div>
